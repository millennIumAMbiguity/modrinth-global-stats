function setWithExpiry(t,e,o=864e5){const a=new Date,n={value:e,expiry:a.getTime()+o};localStorage.setItem(t,JSON.stringify(n))}function setCookie(t,e){const o=new Date;o.setTime(o.getTime()+864e5);let a="expires="+o.toUTCString();document.cookie=t+"="+JSON.stringify(e)+";"+a+";path=/"}function getWithExpiry(t){const e=localStorage.getItem(t);if(!e)return null;const o=JSON.parse(e),a=new Date;return a.getTime()>o.expiry?(localStorage.removeItem(t),null):o.value}function getCookie(t){let e=t+"=",o=decodeURIComponent(document.cookie),a=o.split(";");for(let t=0;t<a.length;t++){let o=a[t];for(;" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return JSON.parse(o.substring(e.length,o.length))}return""}async function fetchGameVersions(){if(versions.length>0)return versions;const t=getCookie("game_versions");if(t)return versions=t;const e="https://api.modrinth.com/v2/tag/game_version";try{const t=await fetch(e),o=await t.json();return versions=o.filter(t=>"release"===t.version_type).map(t=>t.version),setCookie("game_versions",versions),versions}catch(t){return console.error("Error fetching data:",t),[]}}async function fetchModCountForVersion(t){const e=`https://api.modrinth.com/v2/search?facets=[["versions:${t}"]]&limit=1`;try{const t=await fetch(e),o=await t.json();return o.total_hits}catch(t){return console.error("Error fetching data:",t),0}}async function fetchModActivityLast30Days(t){const e=`https://api.modrinth.com/v2/search?facets=[["versions:${t}"],["created_timestamp>=${timestamp}"]]&limit=1`;try{const t=await fetch(e),o=await t.json();return o.total_hits}catch(t){return console.error("Error fetching mod activity:",t),0}}function getDate30DaysAgo(){const t=new Date;return t.setDate(t.getDate()-30),timestamp=t.getTime()/1e3}async function displayModCounts(){const t=await fetchGameVersions();let e=[];modChart=new Chart(document.getElementById("modChart").getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{label:"Number of Projects",data:[],backgroundColor:[],borderColor:"#16181c",borderWidth:1}]},options:{responsive:!0,layout:{padding:40},plugins:{legend:{position:"bottom",display:!1},tooltip:{callbacks:{label:function(t){return`Minecraft ${t.label}: ${t.raw} projects`}}},datalabels:{anchor:"end",align:"end",offset:10,formatter:(t,e)=>{const o=modChart.data.datasets[0].data.reduce((t,e)=>t+e,0),a=(t/o*100).toFixed(2)+"%";return a<1?"":e.chart.data.labels[e.dataIndex]+": "+a},color:"#b0bac5",backgroundColor:"#26292f",borderColor:"#16181c",borderWidth:1,borderRadius:3,padding:{top:6,bottom:6,left:10,right:10},font:{family:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI"',size:12}}}},plugins:[ChartDataLabels]});const o=getCookie("mod_counts");if(o)e=o;else{const o=[{version:"loading%",count:"0"}];for(let a=0;a<t.length;a++){const n=t[a],r=await fetchModCountForVersion(n);e.push({version:n,count:r}),a%2==0&&(o[0].version="loading: "+Math.floor(100*a/t.length)+"%",updateChart(o))}e.sort((t,e)=>e.count-t.count),setCookie("mod_counts",e)}const a=e.reduce((t,e)=>t+e.count,0),n=[],r=[];let s=0;for(let t of e){const e=t.count/a*100;e>=2?(n.push(t.version),r.push(t.count)):s+=t.count}s>0&&(n.push("Others"),r.push(s)),updateChart(n.map((t,e)=>({version:t,count:r[e]})),!0)}function updateChart(t,e){modChart.data.labels=t.map(t=>t.version),modChart.data.datasets[0].data=t.map(t=>t.count),modChart.data.datasets[0].backgroundColor=generateColors(t.length),modChart.options.plugins.datalabels.formatter=((t,o)=>{if(e){const e=modChart.data.datasets[0].data.reduce((t,e)=>t+e,0);let a=(t/e*100).toFixed(2)+"%";return o.chart.data.labels[o.dataIndex]+": "+a}return o.chart.data.labels[o.dataIndex]}),modChart.update()}function generateColors(t){const e=["#ff6384","#36a2eb","#ffcd56","#4bc0c0","#9966ff","#ff9f40"],o=[];for(let a=0;a<t;a++)o.push(e[a%e.length]);return o}async function displayModActivityLast30Days(){const t=await fetchGameVersions();let e=[];modActivityChart=new Chart(document.getElementById("modActivityChart").getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{label:"Number of Projects",data:[],backgroundColor:[],borderColor:"#16181c",borderWidth:1}]},options:{responsive:!0,layout:{padding:40},plugins:{legend:{position:"bottom",display:!1},tooltip:{callbacks:{label:function(t){return`Minecraft ${t.label}: ${t.raw} projects`}}},datalabels:{anchor:"end",align:"end",offset:10,formatter:(t,e)=>{const o=modActivityChart.data.datasets[0].data.reduce((t,e)=>t+e,0),a=(t/o*100).toFixed(2)+"%";return a<1?"":e.chart.data.labels[e.dataIndex]+": "+a},color:"#b0bac5",backgroundColor:"#26292f",borderColor:"#16181c",borderWidth:1,borderRadius:3,padding:{top:6,bottom:6,left:10,right:10},font:{family:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI"',size:12}}}},plugins:[ChartDataLabels]});const o=getCookie("new_mods");if(o)e=o;else{const o=[{version:"loading%",count:"0"}];for(let a=0;a<t.length;a++){const n=t[a],r=await fetchModActivityLast30Days(n);e.push({version:n,count:r}),a%2==0&&(o[0].version="loading: "+Math.floor(100*a/t.length)+"%",updateChart30Days(o))}e.sort((t,e)=>e.count-t.count),setCookie("new_mods",e)}const a=e.reduce((t,e)=>t+e.count,0),n=[],r=[];let s=0;for(let t of e){const e=t.count/a*100;e>=2?(n.push(t.version),r.push(t.count)):s+=t.count}s>0&&(n.push("Others"),r.push(s)),updateChart30Days(n.map((t,e)=>({version:t,count:r[e]})),!0)}function updateChart30Days(t,e){modActivityChart.data.labels=t.map(t=>t.version),modActivityChart.data.datasets[0].data=t.map(t=>t.count),modActivityChart.data.datasets[0].backgroundColor=generateColors(t.length),modActivityChart.options.plugins.datalabels.formatter=((t,o)=>{if(e){const e=modActivityChart.data.datasets[0].data.reduce((t,e)=>t+e,0);let a=(t/e*100).toFixed(2)+"%";return o.chart.data.labels[o.dataIndex]+": "+a}return o.chart.data.labels[o.dataIndex]}),modActivityChart.update()}let modChart,modActivityChart,versions=[],timestamp=0;getDate30DaysAgo(),displayModCounts(),displayModActivityLast30Days();