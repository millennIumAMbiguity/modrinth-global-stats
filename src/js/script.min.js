function setWithExpiry(t,e,o=864e5){const a=new Date,r={value:e,expiry:a.getTime()+o};localStorage.setItem(t,JSON.stringify(r))}function setCookie(t,e){const o=new Date;o.setTime(o.getTime()+864e5);let a="expires="+o.toUTCString();document.cookie=t+"="+JSON.stringify(e)+";"+a+";path=/"}function getWithExpiry(t){const e=localStorage.getItem(t);if(!e)return null;const o=JSON.parse(e),a=new Date;return a.getTime()>o.expiry?(localStorage.removeItem(t),null):o.value}function getCookie(t){let e=t+"=",o=decodeURIComponent(document.cookie),a=o.split(";");for(let t=0;t<a.length;t++){let o=a[t];for(;" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return JSON.parse(o.substring(e.length,o.length))}return""}async function fetchGameVersions(){if(versions.length>0)return versions;const t=getCookie("game_versions");if(t)return versions=t;const e="https://api.modrinth.com/v2/tag/game_version";try{const t=await fetch(e),o=await t.json();return versions=o.filter(t=>"release"===t.version_type).map(t=>t.version),setCookie("game_versions",versions),versions}catch(t){return console.error("Error fetching data:",t),[]}}async function fetchModCountForVersion(t){const e=`https://api.modrinth.com/v2/search?facets=[["versions:${t}"]]&limit=1`;try{const t=await fetch(e),o=await t.json();return o.total_hits}catch(t){return console.error("Error fetching data:",t),0}}async function fetchModActivityLast30Days(t){const e=`https://api.modrinth.com/v2/search?facets=[["versions:${t}"],["created_timestamp>=${timestamp}"]]&limit=1`;try{const t=await fetch(e),o=await t.json();return o.total_hits}catch(t){return console.error("Error fetching mod activity:",t),0}}async function fetchFabricVersions(){const t="https://api.modrinth.com/v2/project/P7dR8mSH/version";try{const e=await fetch(t);return await e.json()}catch(t){return console.error("Error fetching data:",t),0}}function formatNumber(t){return t>=1e6?(t/1e6).toFixed(t%1e6==0?0:1)+"M":t>=1e3?(t/1e3).toFixed(t%1e3==0?0:1)+"K":t.toString()}function setChart(t,e){e.chart=new Chart(t.getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{label:"Number of Projects",data:[],backgroundColor:[],borderColor:"#16181c",borderWidth:1}]},options:{responsive:!0,layout:{padding:40},plugins:{legend:{position:"bottom",display:!1},tooltip:{callbacks:{label:function(t){return`Minecraft ${t.label}: ${formatNumber(t.raw)} projects`}}},datalabels:{anchor:"end",align:"end",offset:10,formatter:(t,o)=>{const a=e.chart.data.datasets[0].data.reduce((t,e)=>t+e,0),r=(t/a*100).toFixed(2)+"%";return r<1?"":o.chart.data.labels[o.dataIndex]+": "+r},color:"#b0bac5",backgroundColor:"#26292f",borderColor:"#16181c",borderWidth:1,borderRadius:3,padding:{top:6,bottom:6,left:10,right:10},font:{family:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI"',size:12}}}},plugins:[ChartDataLabels]})}function getDate30DaysAgo(){const t=new Date;return t.setDate(t.getDate()-30),timestamp=t.getTime()/1e3}function updateChartAndSort(t,e,o=2){const a=e.reduce((t,e)=>t+e.c,0),r=[],n=[];let s=0;for(let t of e){const e=t.c/a*100;e>=o?(r.push(t.v),n.push(t.c)):s+=t.c}s>0&&(r.push("Others"),n.push(s)),updateChart(t,r.map((t,e)=>({v:t,c:n[e]})),!0)}function updateChart(t,e,o){const a=t.chart;a.data.labels=e.map(t=>t.v),a.data.datasets[0].data=e.map(t=>t.c),a.data.datasets[0].backgroundColor=generateColors(e.length),a.options.plugins.datalabels.formatter=((t,e)=>{if(o){const o=a.data.datasets[0].data.reduce((t,e)=>t+e,0);let r=(t/o*100).toFixed(2)+"%";return e.chart.data.labels[e.dataIndex]+": "+r}return e.chart.data.labels[e.dataIndex]}),a.update()}function generateColors(t){const e=["#ff6384","#36a2eb","#ffcd56","#4bc0c0","#9966ff","#ff9f40"],o=[];for(let a=0;a<t;a++)o.push(e[a%e.length]);return o}async function displayModCounts(){const t=await fetchGameVersions();let e=[];setChart(document.getElementById("modChart"),modChart);const o=getCookie("mod_counts");if(o)e=o;else{const o=[{v:"loading%",c:"0"}];for(let a=0;a<t.length;a++){const r=t[a],n=await fetchModCountForVersion(r);e.push({v:r,c:n}),a%2==0&&(o[0].v="loading: "+Math.floor(100*a/t.length)+"%",updateChart(modChart,o))}e.sort((t,e)=>e.c-t.c),setCookie("mod_counts",e)}updateChartAndSort(modChart,e)}async function displayModActivityLast30Days(){const t=await fetchGameVersions();let e=[];setChart(document.getElementById("modActivityChart"),modActivityChart);const o=getCookie("new_mods");if(o)e=o;else{const o=[{v:"loading%",c:"0"}];for(let a=0;a<t.length;a++){const r=t[a],n=await fetchModActivityLast30Days(r);e.push({v:r,c:n}),a%2==0&&(o[0].v="loading: "+Math.floor(100*a/t.length)+"%",updateChart(modActivityChart,o))}e.sort((t,e)=>e.c-t.c),setCookie("new_mods",e)}updateChartAndSort(modActivityChart,e)}async function displayFabricApiDownlods(){let t=await fetchGameVersions();t=t.filter(t=>t>="1.14");let e=[];setChart(document.getElementById("fabricDownloadChart"),fabricDownloadChart);const o=getCookie("fabric_downloads");if(o)e=o;else{const o=await fetchFabricVersions();o.forEach(o=>{o.game_versions.forEach(a=>{if(t.includes(a)){const t=e.find(t=>t.v===a);t?t.c+=o.downloads:e.push({v:a,c:o.downloads})}})}),e.sort((t,e)=>e.c-t.c),setCookie("fabric_downloads",e)}updateChartAndSort(fabricDownloadChart,e,1)}const modChart={chart:null},modActivityChart={chart:null},fabricDownloadChart={chart:null};let versions=[],timestamp=0;getDate30DaysAgo(),displayModCounts(),displayModActivityLast30Days(),displayFabricApiDownlods();