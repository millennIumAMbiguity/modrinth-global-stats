function setWithExpiry(t,e,o=864e5){const a=new Date,n={value:e,expiry:a.getTime()+o};localStorage.setItem(t,JSON.stringify(n))}function setCookie(t,e){const o=new Date;o.setTime(o.getTime()+864e5);let a="expires="+o.toUTCString();document.cookie=t+"="+JSON.stringify(e)+";"+a+";path=/"}function getWithExpiry(t){const e=localStorage.getItem(t);if(!e)return null;const o=JSON.parse(e),a=new Date;return a.getTime()>o.expiry?(localStorage.removeItem(t),null):o.value}function getCookie(t){let e=t+"=",o=decodeURIComponent(document.cookie),a=o.split(";");for(let t=0;t<a.length;t++){let o=a[t];for(;" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return JSON.parse(o.substring(e.length,o.length))}return""}async function fetchGameVersions(){if(versions.length>0)return versions;const t=getCookie("game_versions");if(t)return versions=t;const e="https://api.modrinth.com/v2/tag/game_version";try{const t=await fetch(e),o=await t.json();return versions=o.filter(t=>"release"===t.version_type).map(t=>t.version),setCookie("game_versions",versions),versions}catch(t){return console.error("Error fetching data:",t),[]}}async function fetchModCountForVersion(t){const e=`https://api.modrinth.com/v2/search?facets=[["versions:${t}"]]&limit=1`;try{const t=await fetch(e),o=await t.json();return o.total_hits}catch(t){return console.error("Error fetching data:",t),0}}async function fetchModActivityLast30Days(t){const e=`https://api.modrinth.com/v2/search?facets=[["versions:${t}"],["created_timestamp>=${timestamp}"]]&limit=1`;try{const t=await fetch(e),o=await t.json();return o.total_hits}catch(t){return console.error("Error fetching mod activity:",t),0}}function setChart(t,e){e.chart=new Chart(t.getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{label:"Number of Projects",data:[],backgroundColor:[],borderColor:"#16181c",borderWidth:1}]},options:{responsive:!0,layout:{padding:40},plugins:{legend:{position:"bottom",display:!1},tooltip:{callbacks:{label:function(t){return`Minecraft ${t.label}: ${t.raw} projects`}}},datalabels:{anchor:"end",align:"end",offset:10,formatter:(t,o)=>{const a=e.chart.data.datasets[0].data.reduce((t,e)=>t+e,0),n=(t/a*100).toFixed(2)+"%";return n<1?"":o.chart.data.labels[o.dataIndex]+": "+n},color:"#b0bac5",backgroundColor:"#26292f",borderColor:"#16181c",borderWidth:1,borderRadius:3,padding:{top:6,bottom:6,left:10,right:10},font:{family:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI"',size:12}}}},plugins:[ChartDataLabels]})}function getDate30DaysAgo(){const t=new Date;return t.setDate(t.getDate()-30),timestamp=t.getTime()/1e3}function updateChartAndSort(t,e){const o=e.reduce((t,e)=>t+e.count,0),a=[],n=[];let r=0;for(let t of e){const e=t.count/o*100;e>=2?(a.push(t.version),n.push(t.count)):r+=t.count}r>0&&(a.push("Others"),n.push(r)),updateChart(t,a.map((t,e)=>({version:t,count:n[e]})),!0)}function updateChart(t,e,o){const a=t.chart;a.data.labels=e.map(t=>t.version),a.data.datasets[0].data=e.map(t=>t.count),a.data.datasets[0].backgroundColor=generateColors(e.length),a.options.plugins.datalabels.formatter=((t,e)=>{if(o){const o=a.data.datasets[0].data.reduce((t,e)=>t+e,0);let n=(t/o*100).toFixed(2)+"%";return e.chart.data.labels[e.dataIndex]+": "+n}return e.chart.data.labels[e.dataIndex]}),a.update()}function generateColors(t){const e=["#ff6384","#36a2eb","#ffcd56","#4bc0c0","#9966ff","#ff9f40"],o=[];for(let a=0;a<t;a++)o.push(e[a%e.length]);return o}async function displayModCounts(){const t=await fetchGameVersions();let e=[];setChart(document.getElementById("modChart"),modChart);const o=getCookie("mod_counts");if(o)e=o;else{const o=[{version:"loading%",count:"0"}];for(let a=0;a<t.length;a++){const n=t[a],r=await fetchModCountForVersion(n);e.push({version:n,count:r}),a%2==0&&(o[0].version="loading: "+Math.floor(100*a/t.length)+"%",updateChart(modChart,o))}e.sort((t,e)=>e.count-t.count),setCookie("mod_counts",e)}updateChartAndSort(modChart,e)}async function displayModActivityLast30Days(){const t=await fetchGameVersions();let e=[];setChart(document.getElementById("modActivityChart"),modActivityChart);const o=getCookie("new_mods");if(o)e=o;else{const o=[{version:"loading%",count:"0"}];for(let a=0;a<t.length;a++){const n=t[a],r=await fetchModActivityLast30Days(n);e.push({version:n,count:r}),a%2==0&&(o[0].version="loading: "+Math.floor(100*a/t.length)+"%",updateChart(modActivityChart,o))}e.sort((t,e)=>e.count-t.count),setCookie("new_mods",e)}updateChartAndSort(modActivityChart,e)}let modChart={chart:null},modActivityChart={chart:null},versions=[],timestamp=0;getDate30DaysAgo(),displayModCounts(),displayModActivityLast30Days();